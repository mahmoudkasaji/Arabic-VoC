<!DOCTYPE html>
<html lang="{{ get_language_info().code }}" dir="{{ get_language_info().direction }}">
<head>
    {% include 'components/head.html' %}
    <title>Survey Delivery - Voice of Customer Platform</title>
    
    <style>
        .code-textarea {
            font-family: 'Courier New', monospace;
            font-size: 12px;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
        }
        
        .javascript-code-section {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .preview-container {
            background: linear-gradient(45deg, #f8f9fa 25%, transparent 25%), 
                        linear-gradient(-45deg, #f8f9fa 25%, transparent 25%), 
                        linear-gradient(45deg, transparent 75%, #f8f9fa 75%), 
                        linear-gradient(-45deg, transparent 75%, #f8f9fa 75%);
            background-size: 10px 10px;
            background-position: 0 0, 0 5px, 5px -5px, -5px 0px;
        }
        
        .distribution-card {
            background: #fff;
            border: 1px solid #dee2e6;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.2s ease;
        }
        
        .distribution-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }
        
        .distribution-header {
            padding: 20px 20px 10px;
            border-bottom: 1px solid #f1f3f4;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .distribution-header i {
            font-size: 1.5rem;
        }
        
        .distribution-header h4 {
            margin: 0;
            color: #2c3e50;
        }
        
        .distribution-body {
            padding: 20px;
        }
    </style>
</head>
<body>
    {% include 'components/unified_navigation.html' %}
    {% include 'components/survey_header.html' %}
    {% include 'components/survey_actions.html' %}
    
    <div class="container-custom">

        <!-- Step 1: Create or Select Survey -->
        <div class="card-custom mb-4">
            <div class="card-header-custom">
                <h3 class="card-title">
                    <span class="step-number">1</span>
                    Ø¥Ù†Ø´Ø§Ø¡ Ø£Ùˆ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹
                </h3>
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <div class="survey-option">
                        <i class="fas fa-plus-circle text-primary-custom mb-3"></i>
                        <h4>Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø³ØªØ·Ù„Ø§Ø¹ Ø¬Ø¯ÙŠØ¯</h4>
                        <p>Ø§Ø³ØªØ®Ø¯Ù… Ù…Ù†Ø´Ø¦ Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹Ø§Øª Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø³ØªØ·Ù„Ø§Ø¹ Ù…Ø®ØµØµ</p>
                        <a href="/surveys/builder" class="btn btn-primary-custom">
                            <i class="fas fa-edit me-2"></i>Ù…Ù†Ø´Ø¦ Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹Ø§Øª
                        </a>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="survey-option">
                        <i class="fas fa-list text-success-custom mb-3"></i>
                        <h4>Ø§Ø®ØªÙŠØ§Ø± Ø§Ø³ØªØ·Ù„Ø§Ø¹ Ù…ÙˆØ¬ÙˆØ¯</h4>
                        <p>Ø§Ø®ØªØ± Ù…Ù† Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ù„Ø¯ÙŠÙƒ</p>
                        <select class="form-select mb-3" id="existingSurvey">
                            <option value="">Ø§Ø®ØªØ± Ø§Ø³ØªØ·Ù„Ø§Ø¹...</option>
                            {% for survey in surveys %}
                            <option value="{{ survey.id }}" data-survey='{{ survey | tojson }}'>
                                {{ survey.title }} ({{ survey.questions_count }} Ø£Ø³Ø¦Ù„Ø©)
                            </option>
                            {% endfor %}
                            {% if not surveys %}
                            <option disabled>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø§Ø³ØªØ·Ù„Ø§Ø¹Ø§Øª Ù…ØªØ§Ø­Ø© - Ù‚Ù… Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø³ØªØ·Ù„Ø§Ø¹ Ø£ÙˆÙ„Ø§Ù‹</option>
                            {% endif %}
                        </select>
                        <button class="btn btn-success-custom" onclick="selectSurvey()">
                            <i class="fas fa-check me-2"></i>Ø§Ø®ØªÙŠØ§Ø± Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 2: Generate Web Survey Link -->
        <div class="card-custom mb-4" id="step2" style="display: none;">
            <div class="card-header-custom">
                <h3 class="card-title">
                    <span class="step-number">2</span>
                    Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹
                </h3>
            </div>
            
            <div class="row">
                <div class="col-md-8">
                    <div class="survey-link-generator">
                        <h5>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹ Ø§Ù„Ù…Ø­Ø¯Ø¯:</h5>
                        <div class="selected-survey-info mb-3" id="selectedSurveyInfo">
                            <!-- Survey info will be populated here -->
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">Ø¹Ù†ÙˆØ§Ù† Ù…Ø®ØµØµ Ù„Ù„Ø±Ø§Ø¨Ø· (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                                <input type="text" class="form-control" id="customSlug" placeholder="customer-survey-2024">
                                <small class="text-muted">Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¥Ø°Ø§ ØªÙØ±Ùƒ ÙØ§Ø±ØºØ§Ù‹</small>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                                <input type="datetime-local" class="form-control" id="expiryDate">
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="requirePassword">
                                <label class="form-check-label" for="requirePassword">
                                    Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹ Ø¨ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±
                                </label>
                            </div>
                            <input type="password" class="form-control mt-2" id="surveyPassword" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" style="display: none;">
                        </div>
                        
                        <button class="btn btn-primary-custom btn-lg" onclick="generateSurveyLink()">
                            <i class="fas fa-link me-2"></i>Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹
                        </button>
                    </div>
                </div>
                
                <div class="col-md-4">
                    <div class="preview-box">
                        <h6>Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹</h6>
                        <div class="survey-preview" id="surveyPreview">
                            <div class="text-center text-muted">
                                <i class="fas fa-eye-slash mb-2"></i>
                                <p>Ø§Ø®ØªØ± Ø§Ø³ØªØ·Ù„Ø§Ø¹ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 3: Distribution Options -->
        <div class="card-custom mb-4" id="step3" style="display: none;">
            <div class="card-header-custom">
                <h3 class="card-title">
                    <span class="step-number">3</span>
                    Ø·Ø±Ù‚ Ø§Ù„ØªÙˆØ²ÙŠØ¹
                </h3>
            </div>
            
            <!-- Generated Survey Link Display -->
            <div class="generated-link-section mb-4" id="generatedLinkSection" style="display: none;">
                <div class="alert alert-success d-flex align-items-center">
                    <i class="fas fa-check-circle me-3"></i>
                    <div class="flex-grow-1">
                        <strong>ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹ Ø¨Ù†Ø¬Ø§Ø­!</strong>
                        <div class="survey-url mt-2">
                            <input type="text" class="form-control" id="generatedUrl" readonly>
                        </div>
                    </div>
                    <button class="btn btn-outline-success btn-sm" onclick="copyToClipboard()">
                        <i class="fas fa-copy me-1"></i>Ù†Ø³Ø®
                    </button>
                </div>
            </div>
            
            <!-- Distribution Methods -->
            <div class="row">
                <!-- Email Distribution -->
                <div class="col-lg-6 mb-4">
                    <div class="distribution-card">
                        <div class="distribution-header">
                            <i class="fas fa-envelope text-primary-custom"></i>
                            <h4>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</h4>
                        </div>
                        <div class="distribution-body">
                            <textarea class="form-control mb-3" rows="3" id="emailList" placeholder="Ø£Ø¯Ø®Ù„ Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ (ÙˆØ§Ø­Ø¯ ÙÙŠ ÙƒÙ„ Ø³Ø·Ø±)&#10;example1@email.com&#10;example2@email.com"></textarea>
                            <div class="mb-3">
                                <input type="text" class="form-control mb-2" id="emailSubject" placeholder="Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„Ø±Ø³Ø§Ù„Ø©" value="Ø¯Ø¹ÙˆØ© Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ© ÙÙŠ Ø§Ø³ØªØ·Ù„Ø§Ø¹">
                                <textarea class="form-control" rows="3" id="emailMessage" placeholder="Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø©">Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ

Ù†ÙˆØ¯ Ø¯Ø¹ÙˆØªÙƒ Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ© ÙÙŠ Ø§Ø³ØªØ·Ù„Ø§Ø¹ Ù…Ù‡Ù…. Ù…Ø´Ø§Ø±ÙƒØªÙƒ Ø³ØªØ³Ø§Ø¹Ø¯Ù†Ø§ ÙÙŠ ØªØ­Ø³ÙŠÙ† Ø®Ø¯Ù…Ø§ØªÙ†Ø§.

Ø±Ø§Ø¨Ø· Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹: [SURVEY_LINK]

Ø´ÙƒØ±Ø§Ù‹ Ù„ÙˆÙ‚ØªÙƒ
ÙØ±ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ù„</textarea>
                            </div>
                            <button class="btn btn-primary-custom w-100" onclick="sendEmail()">
                                <i class="fas fa-paper-plane me-2"></i>Ø¥Ø±Ø³Ø§Ù„ Ø¹Ø¨Ø± Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- SMS Distribution -->
                <div class="col-lg-6 mb-4">
                    <div class="distribution-card">
                        <div class="distribution-header">
                            <i class="fas fa-sms text-success-custom"></i>
                            <h4>Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù†ØµÙŠØ©</h4>
                        </div>
                        <div class="distribution-body">
                            <textarea class="form-control mb-3" rows="3" id="phoneList" placeholder="Ø£Ø¯Ø®Ù„ Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù‡ÙˆØ§ØªÙ (ÙˆØ§Ø­Ø¯ ÙÙŠ ÙƒÙ„ Ø³Ø·Ø±)&#10;+966501234567&#10;+966507654321"></textarea>
                            <div class="mb-3">
                                <label class="form-label">Ù†Øµ Ø§Ù„Ø±Ø³Ø§Ù„Ø© (160 Ø­Ø±Ù ÙƒØ­Ø¯ Ø£Ù‚ØµÙ‰)</label>
                                <textarea class="form-control" rows="3" id="smsMessage" maxlength="160" placeholder="Ø´Ø§Ø±Ùƒ ÙÙŠ Ø§Ø³ØªØ·Ù„Ø§Ø¹Ù†Ø§: [SURVEY_LINK]">Ù…Ø±Ø­Ø¨Ø§Ù‹! Ù†Ø¯Ø¹ÙˆÙƒ Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ© ÙÙŠ Ø§Ø³ØªØ·Ù„Ø§Ø¹ Ø³Ø±ÙŠØ¹ Ù„ØªØ­Ø³ÙŠÙ† Ø®Ø¯Ù…Ø§ØªÙ†Ø§: [SURVEY_LINK]</textarea>
                                <small class="text-muted"><span id="smsCount">0</span>/160 Ø­Ø±Ù</small>
                            </div>
                            <button class="btn btn-success-custom w-100" onclick="sendSMS()">
                                <i class="fas fa-mobile-alt me-2"></i>Ø¥Ø±Ø³Ø§Ù„ Ø¹Ø¨Ø± Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù†ØµÙŠØ©
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- WhatsApp Distribution -->
                <div class="col-lg-6 mb-4">
                    <div class="distribution-card">
                        <div class="distribution-header">
                            <i class="fab fa-whatsapp" style="color: #25D366;"></i>
                            <h4>ÙˆØ§ØªØ³Ø§Ø¨</h4>
                        </div>
                        <div class="distribution-body">
                            <textarea class="form-control mb-3" rows="3" id="whatsappList" placeholder="Ø£Ø¯Ø®Ù„ Ø£Ø±Ù‚Ø§Ù… ÙˆØ§ØªØ³Ø§Ø¨ (ÙˆØ§Ø­Ø¯ ÙÙŠ ÙƒÙ„ Ø³Ø·Ø±)&#10;+966501234567&#10;+966507654321"></textarea>
                            <div class="mb-3">
                                <textarea class="form-control" rows="4" id="whatsappMessage" placeholder="Ø±Ø³Ø§Ù„Ø© ÙˆØ§ØªØ³Ø§Ø¨">Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…ØŒ

Ù†Ø£Ù…Ù„ Ù…Ù†Ùƒ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© ÙÙŠ Ø§Ø³ØªØ·Ù„Ø§Ø¹ Ù…Ù‡Ù… Ù„ØªØ·ÙˆÙŠØ± Ø®Ø¯Ù…Ø§ØªÙ†Ø§.

Ø±Ø§Ø¨Ø· Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹: [SURVEY_LINK]

Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ ğŸ™</textarea>
                            </div>
                            <button class="btn w-100" style="background-color: #25D366; color: white;" onclick="sendWhatsApp()">
                                <i class="fab fa-whatsapp me-2"></i>Ø¥Ø±Ø³Ø§Ù„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- QR Code Generation -->
                <div class="col-lg-6 mb-4">
                    <div class="distribution-card">
                        <div class="distribution-header">
                            <i class="fas fa-qrcode text-info-custom"></i>
                            <h4>Ø±Ù…Ø² QR</h4>
                        </div>
                        <div class="distribution-body text-center">
                            <p class="text-muted mb-3">Ø¥Ù†Ø´Ø§Ø¡ Ø±Ù…Ø² QR Ù„Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹ Ù„Ù…Ø´Ø§Ø±ÙƒØªÙ‡ ÙÙŠ Ø§Ù„Ø£Ù…Ø§ÙƒÙ† Ø§Ù„Ù…Ø§Ø¯ÙŠØ©</p>
                            <div class="qr-code-container mb-3" id="qrCodeContainer">
                                <div class="qr-placeholder">
                                    <i class="fas fa-qrcode" style="font-size: 4rem; color: #dee2e6;"></i>
                                    <p class="text-muted mt-2">Ø³ÙŠØ¸Ù‡Ø± Ø±Ù…Ø² QR Ù‡Ù†Ø§</p>
                                </div>
                            </div>
                            <button class="btn btn-info-custom w-100 mb-2" onclick="generateQRCode()">
                                <i class="fas fa-qrcode me-2"></i>Ø¥Ù†Ø´Ø§Ø¡ Ø±Ù…Ø² QR
                            </button>
                            <button class="btn btn-outline-info-custom w-100" onclick="downloadQR()" style="display: none;" id="downloadQRBtn">
                                <i class="fas fa-download me-2"></i>ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ù…Ø²
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Sidebar Feedback Widget -->
                <div class="col-lg-6 mb-4">
                    <div class="distribution-card">
                        <div class="distribution-header">
                            <i class="fas fa-comment text-success-custom"></i>
                            <h4>Ø£Ø¯Ø§Ø© Ø§Ù„ØªØºØ°ÙŠØ© Ø§Ù„Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©</h4>
                        </div>
                        <div class="distribution-body">
                            <p class="text-muted mb-3">Ø£Ù†Ø´Ø¦ Ø£Ø¯Ø§Ø© ØªØºØ°ÙŠØ© Ø±Ø§Ø¬Ø¹Ø© ØªØ¸Ù‡Ø± Ø¹Ù„Ù‰ Ø¬Ø§Ù†Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù„Ø¬Ù…Ø¹ Ø§Ù„Ø¢Ø±Ø§Ø¡ Ø¨Ø´ÙƒÙ„ Ù…Ø³ØªÙ…Ø±</p>
                            
                            <!-- Sidebar Widget Configuration -->
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label class="form-label">Ù…ÙˆØ¶Ø¹ Ø§Ù„Ø£Ø¯Ø§Ø©</label>
                                    <select class="form-select" id="sidebarPosition">
                                        <option value="bottom-right">Ø£Ø³ÙÙ„ Ø§Ù„ÙŠÙ…ÙŠÙ†</option>
                                        <option value="bottom-left" selected>Ø£Ø³ÙÙ„ Ø§Ù„ÙŠØ³Ø§Ø± (Ø¹Ø±Ø¨ÙŠ)</option>
                                        <option value="center-right">ÙˆØ³Ø· Ø§Ù„ÙŠÙ…ÙŠÙ†</option>
                                        <option value="center-left">ÙˆØ³Ø· Ø§Ù„ÙŠØ³Ø§Ø±</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Ù„ÙˆÙ† Ø§Ù„Ø£Ø¯Ø§Ø©</label>
                                    <select class="form-select" id="sidebarColor">
                                        <option value="#2E8B57" selected>Ø£Ø®Ø¶Ø±</option>
                                        <option value="#007bff">Ø£Ø²Ø±Ù‚</option>
                                        <option value="#ff6b35">Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ</option>
                                        <option value="#6f42c1">Ø¨Ù†ÙØ³Ø¬ÙŠ</option>
                                    </select>
                                </div>
                            </div>
                            
                            <!-- Generated Sidebar Widget Code -->
                            <div class="javascript-code-section" id="sidebarCodeSection" style="display: none;">
                                <label class="form-label fw-bold">ÙƒÙˆØ¯ JavaScript Ù„Ù„Ø£Ø¯Ø§Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©:</label>
                                <div class="position-relative">
                                    <textarea class="form-control code-textarea" id="sidebarJavascriptCode" readonly rows="8"></textarea>
                                    <button class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 m-2" onclick="copySidebarCode()">
                                        <i class="fas fa-copy"></i> Ù†Ø³Ø®
                                    </button>
                                </div>
                                <small class="text-muted mt-2 d-block">
                                    <i class="fas fa-info-circle me-1"></i>
                                    Ø§Ù†Ø³Ø® Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ ÙˆØ§Ù„ØµÙ‚Ù‡ ÙÙŠ Ø£ÙŠ ØµÙØ­Ø© HTML Ù„Ø¥Ø¸Ù‡Ø§Ø± Ø£Ø¯Ø§Ø© Ø§Ù„ØªØºØ°ÙŠØ© Ø§Ù„Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©
                                </small>
                            </div>
                            
                            <!-- Sidebar Preview Section -->
                            <div class="widget-preview-section mt-3" id="sidebarPreviewSection" style="display: none;">
                                <label class="form-label fw-bold">Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø£Ø¯Ø§Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©:</label>
                                <div class="preview-container border rounded p-3 bg-light position-relative" style="height: 200px; overflow: hidden;">
                                    <div class="preview-sidebar-widget" id="previewSidebarWidget">
                                        <!-- Sidebar widget preview will appear here -->
                                    </div>
                                    <small class="text-muted">Ù…Ø¹Ø§ÙŠÙ†Ø© ØªÙØ§Ø¹Ù„ÙŠØ© Ù„Ù„Ø£Ø¯Ø§Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© ÙƒÙ…Ø§ Ø³ØªØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ù…ÙˆÙ‚Ø¹</small>
                                </div>
                            </div>
                            
                            <button class="btn btn-success-custom w-100 mt-3" onclick="generateSidebarWidget()">
                                <i class="fas fa-comment me-2"></i>Ø¥Ù†Ø´Ø§Ø¡ Ø£Ø¯Ø§Ø© Ø§Ù„ØªØºØ°ÙŠØ© Ø§Ù„Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ©
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Footer Survey Widget -->
                <div class="col-lg-6 mb-4">
                    <div class="distribution-card">
                        <div class="distribution-header">
                            <i class="fas fa-window-maximize text-warning"></i>
                            <h4>Ø£Ø¯Ø§Ø© Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹ ÙÙŠ Ø§Ù„ØªØ°ÙŠÙŠÙ„</h4>
                        </div>
                        <div class="distribution-body">
                            <p class="text-muted mb-3">Ø¥Ù†Ø´Ø§Ø¡ Ø´Ø±ÙŠØ· Ø§Ø³ØªØ·Ù„Ø§Ø¹ ÙŠØ¸Ù‡Ø± ÙÙŠ Ø£Ø³ÙÙ„ Ø§Ù„ØµÙØ­Ø© Ù…Ø«Ù„ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ø­ÙƒÙˆÙ…ÙŠØ© (pa.gov)</p>
                            
                            <!-- Footer Widget Configuration -->
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label class="form-label">Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ©</label>
                                    <select class="form-select" id="footerBackgroundColor">
                                        <option value="#2c3e50" selected>Ø£Ø²Ø±Ù‚ Ø¯Ø§ÙƒÙ†</option>
                                        <option value="#28a745">Ø£Ø®Ø¶Ø±</option>
                                        <option value="#dc3545">Ø£Ø­Ù…Ø±</option>
                                        <option value="#6f42c1">Ø¨Ù†ÙØ³Ø¬ÙŠ</option>
                                        <option value="#fd7e14">Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Ù„ØºØ© Ø§Ù„Ø£Ø¯Ø§Ø©</label>
                                    <select class="form-select" id="footerLanguage">
                                        <option value="ar" selected>Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                                        <option value="en">English</option>
                                        <option value="auto">ØªÙ„Ù‚Ø§Ø¦ÙŠ</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label class="form-label">Ù†Øµ Ø§Ù„Ø¯Ø¹ÙˆØ©</label>
                                    <input type="text" class="form-control" id="footerCallToAction" value="Ø´Ø§Ø±ÙƒÙ†Ø§ Ø±Ø£ÙŠÙƒ">
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Ù†Øµ Ø§Ù„ÙˆØµÙ</label>
                                    <input type="text" class="form-control" id="footerDescription" value="ÙŠØ³ØªØºØ±Ù‚ 3 Ø¯Ù‚Ø§Ø¦Ù‚ ÙÙ‚Ø·">
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="footerCloseable" checked>
                                    <label class="form-check-label" for="footerCloseable">
                                        Ø§Ù„Ø³Ù…Ø§Ø­ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¨Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø´Ø±ÙŠØ·
                                    </label>
                                </div>
                            </div>
                            
                            <!-- Generated Footer Widget Code -->
                            <div class="javascript-code-section" id="footerCodeSection" style="display: none;">
                                <label class="form-label fw-bold">ÙƒÙˆØ¯ Ø£Ø¯Ø§Ø© Ø§Ù„ØªØ°ÙŠÙŠÙ„:</label>
                                <div class="position-relative">
                                    <textarea class="form-control code-textarea" id="footerJavascriptCode" readonly rows="12"></textarea>
                                    <button class="btn btn-sm btn-outline-secondary position-absolute top-0 end-0 m-2" onclick="copyFooterCode()">
                                        <i class="fas fa-copy"></i> Ù†Ø³Ø®
                                    </button>
                                </div>
                                <small class="text-muted mt-2 d-block">
                                    <i class="fas fa-info-circle me-1"></i>
                                    Ø§Ù†Ø³Ø® Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ ÙˆØ§Ù„ØµÙ‚Ù‡ Ù‚Ø¨Ù„ Ø¥ØºÙ„Ø§Ù‚ tag &lt;/body&gt; ÙÙŠ Ø£ÙŠ ØµÙØ­Ø© HTML
                                </small>
                            </div>
                            
                            <!-- Footer Preview Section -->
                            <div class="widget-preview-section mt-3" id="footerPreviewSection" style="display: none;">
                                <label class="form-label fw-bold">Ù…Ø¹Ø§ÙŠÙ†Ø© Ø´Ø±ÙŠØ· Ø§Ù„ØªØ°ÙŠÙŠÙ„:</label>
                                <div class="preview-container border rounded bg-light position-relative" style="height: 200px; overflow: hidden;">
                                    <div class="preview-footer-widget" id="previewFooterWidget">
                                        <!-- Footer widget preview will appear here -->
                                    </div>
                                    <small class="text-muted position-absolute top-0 start-0 p-2">Ù…Ø¹Ø§ÙŠÙ†Ø© Ø´Ø±ÙŠØ· Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹ ÙƒÙ…Ø§ Ø³ÙŠØ¸Ù‡Ø± ÙÙŠ Ø£Ø³ÙÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹</small>
                                </div>
                            </div>
                            
                            <button class="btn btn-warning w-100 mt-3" onclick="generateFooterWidget()">
                                <i class="fas fa-window-maximize me-2"></i>Ø¥Ù†Ø´Ø§Ø¡ Ø´Ø±ÙŠØ· Ø§Ù„ØªØ°ÙŠÙŠÙ„
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Section -->
        <div class="card-custom" id="resultsSection" style="display: none;">
            <div class="card-header-custom">
                <h3 class="card-title">
                    <i class="fas fa-chart-bar me-2"></i>
                    Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªÙˆØ²ÙŠØ¹
                </h3>
            </div>
            <div id="distributionResults">
                <!-- Results will be populated here -->
            </div>
        </div>
    </div>

    {% include 'components/scripts.html' %}
    
    <script>
    let selectedSurveyId = null;
    let generatedSurveyUrl = null;
    let currentSurveyUrl = null;
    
    // Initialize survey navigation
    document.addEventListener('DOMContentLoaded', function() {
        SurveyNavigation.setPage(
            'ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹Ø§Øª',
            'Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø³ØªØ·Ù„Ø§Ø¹ ÙˆÙŠØ¨ ÙˆØªÙˆØ²ÙŠØ¹Ù‡ Ø¹Ø¨Ø± Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙˆØ§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù†ØµÙŠØ© ÙˆÙˆØ§ØªØ³Ø§Ø¨ ÙˆØ±Ù…ÙˆØ² QR',
            [
                { title: 'Ø§Ù„ØªÙˆØ²ÙŠØ¹', url: '/surveys/distribution' }
            ]
        );
        SurveyNavigation.setActiveNav('surveys');
        SurveyActions.updateProgress(1, 2, 'Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹');
    });
    
    // SMS character counter
    document.getElementById('smsMessage').addEventListener('input', function() {
        const count = this.value.length;
        document.getElementById('smsCount').textContent = count;
    });
    
    // Password field toggle
    document.getElementById('requirePassword').addEventListener('change', function() {
        const passwordField = document.getElementById('surveyPassword');
        passwordField.style.display = this.checked ? 'block' : 'none';
    });
    
    // Survey selection
    function selectSurvey() {
        const surveySelect = document.getElementById('existingSurvey');
        selectedSurveyId = surveySelect.value;
        
        if (!selectedSurveyId) {
            alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ø³ØªØ·Ù„Ø§Ø¹');
            return;
        }
        
        try {
            // Get survey data from select option
            const selectedOption = surveySelect.options[surveySelect.selectedIndex];
            const surveyDataAttr = selectedOption.getAttribute('data-survey');
            
            if (!surveyDataAttr) {
                throw new Error('Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹ ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©');
            }
            
            const surveyData = JSON.parse(surveyDataAttr);
            console.log('Selected survey data:', surveyData);
            
            // Validate required data
            if (!surveyData.uuid) {
                throw new Error('Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹ ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø© - Ù…Ø¹Ø±Ù Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹ Ù…ÙÙ‚ÙˆØ¯');
            }
            
            // Calculate estimated time (1 minute per 2 questions)
            const questionsCount = surveyData.questions_count || 0;
            const estimatedMinutes = Math.max(1, Math.ceil(questionsCount / 2));
            const estimatedTime = estimatedMinutes === 1 ? 'Ø¯Ù‚ÙŠÙ‚Ø© ÙˆØ§Ø­Ø¯Ø©' : `${estimatedMinutes} Ø¯Ù‚Ø§Ø¦Ù‚`;
            
            // Show survey info with better styling
            document.getElementById('selectedSurveyInfo').innerHTML = `
                <div class="selected-survey-card border rounded p-3 bg-light">
                    <h6><i class="fas fa-poll me-2 text-primary"></i>${surveyData.title || 'Ø§Ø³ØªØ·Ù„Ø§Ø¹ Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†'}</h6>
                    <p class="text-muted mb-2">${surveyData.description || 'Ø§Ø³ØªØ·Ù„Ø§Ø¹ Ù…Ø®ØµØµ'}</p>
                    <div class="row">
                        <div class="col-md-6">
                            <small class="text-muted"><i class="fas fa-question-circle me-1"></i>${questionsCount} Ø£Ø³Ø¦Ù„Ø©</small>
                        </div>
                        <div class="col-md-6">
                            <small class="text-muted"><i class="fas fa-clock me-1"></i>${estimatedTime}</small>
                        </div>
                    </div>
                    <div class="mt-2">
                        <small class="badge bg-${surveyData.status === 'published' ? 'success' : 'warning'}">${surveyData.status === 'published' ? 'Ù…Ù†Ø´ÙˆØ±' : 'Ù…Ø³ÙˆØ¯Ø©'}</small>
                        <small class="text-muted ms-2">ID: ${surveyData.short_id || (surveyData.uuid ? surveyData.uuid.substring(0, 8) : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯')}</small>
                    </div>
                </div>
            `;
            
            // Show survey preview
            document.getElementById('surveyPreview').innerHTML = `
                <div class="survey-preview-content">
                    <h6>${surveyData.title || 'Ø§Ø³ØªØ·Ù„Ø§Ø¹ Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†'}</h6>
                    <p class="small text-muted">${surveyData.description || 'Ø§Ø³ØªØ·Ù„Ø§Ø¹ Ù…Ø®ØµØµ ØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ù†Ø´Ø¦ Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹Ø§Øª'}</p>
                    <div class="preview-info">
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="badge bg-primary">${questionsCount} Ø£Ø³Ø¦Ù„Ø©</span>
                            <span class="small text-muted">${estimatedTime}</span>
                        </div>
                        <div class="mt-2">
                            <small class="text-success">âœ“ Ø¬Ø§Ù‡Ø² Ù„Ù„ØªÙˆØ²ÙŠØ¹</small>
                        </div>
                    </div>
                </div>
            `;
            
            // Store the actual survey URL from database (use full live URL or construct one)
            currentSurveyUrl = surveyData.full_public_url || surveyData.public_url || `${window.location.origin}/survey/${surveyData.uuid}`;
            console.log('Survey URL set to:', currentSurveyUrl);
            
            // Skip step 2 and go directly to distribution options
            // Auto-generate link immediately
            generatedSurveyUrl = currentSurveyUrl;
            
            // Update placeholders in messages
            updateMessagePlaceholders();
            
            // Show step 3 directly and update progress to 2-step process
            document.getElementById('step3').style.display = 'block';
            SurveyActions.updateProgress(2, 2, 'Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØªÙˆØ²ÙŠØ¹');
            
            // Show generated link section
            document.getElementById('generatedUrl').value = generatedSurveyUrl;
            document.getElementById('generatedLinkSection').style.display = 'block';
            
            // Generate QR code for the survey
            generateQRCode(generatedSurveyUrl);
            
            // Update embeddable widget code with real survey URL
            updateEmbeddableWidget();
            
            // Scroll to step 3
            document.getElementById('step3').scrollIntoView({ behavior: 'smooth' });
            showNotification('ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
            
        } catch (error) {
            console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹:', error);
            alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
        }
    }
    
    // Generate survey link
    function generateSurveyLink() {
        if (!selectedSurveyId) {
            alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ø³ØªØ·Ù„Ø§Ø¹ Ø£ÙˆÙ„Ø§Ù‹');
            return;
        }
        
        if (!currentSurveyUrl) {
            alert('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø±Ø§Ø¨Ø· Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹');
            return;
        }
        
        // Use the real survey URL from the database (already full URL)
        generatedSurveyUrl = currentSurveyUrl;
        
        // Show generated link
        document.getElementById('generatedUrl').value = generatedSurveyUrl;
        document.getElementById('generatedLinkSection').style.display = 'block';
        
        // Update placeholders in messages
        updateMessagePlaceholders();
        
        // Show step 3 and update progress
        document.getElementById('step3').style.display = 'block';
        SurveyActions.updateProgress(3, 3, 'Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØªÙˆØ²ÙŠØ¹');
        
        // Generate QR code for the survey
        generateQRCode(generatedSurveyUrl);
        
        // Update embeddable widget code with real survey URL
        updateEmbeddableWidget();
        
        // Scroll to step 3
        document.getElementById('step3').scrollIntoView({ behavior: 'smooth' });
        
        // Show success message
        showNotification('Ø±Ø§Ø¨Ø· Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹ Ø¬Ø§Ù‡Ø² Ù„Ù„ØªÙˆØ²ÙŠØ¹! ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø§Ø®ØªÙŠØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªÙˆØ²ÙŠØ¹', 'success');
    }
    
    // Update message placeholders
    function updateMessagePlaceholders() {
        if (!generatedSurveyUrl) return;
        
        // Update email message
        const emailMessage = document.getElementById('emailMessage');
        emailMessage.value = emailMessage.value.replace('[SURVEY_LINK]', generatedSurveyUrl);
        
        // Update SMS message
        const smsMessage = document.getElementById('smsMessage');
        smsMessage.value = smsMessage.value.replace('[SURVEY_LINK]', generatedSurveyUrl);
        
        // Update WhatsApp message
        const whatsappMessage = document.getElementById('whatsappMessage');
        whatsappMessage.value = whatsappMessage.value.replace('[SURVEY_LINK]', generatedSurveyUrl);
    }
    
    // Copy to clipboard
    function copyToClipboard() {
        const urlField = document.getElementById('generatedUrl');
        urlField.select();
        document.execCommand('copy');
        showNotification('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©', 'info');
    }
    
    // Send email
    function sendEmail() {
        const emailList = document.getElementById('emailList').value.trim();
        const subject = document.getElementById('emailSubject').value;
        const message = document.getElementById('emailMessage').value;
        
        if (!emailList) {
            alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ');
            return;
        }
        
        const emails = emailList.split('\\n').filter(email => email.trim());
        
        // Simulate email sending
        showDistributionResult('email', `ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹ Ø¥Ù„Ù‰ ${emails.length} Ø¹Ù†ÙˆØ§Ù† Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ`);
    }
    
    // Send SMS
    function sendSMS() {
        const phoneList = document.getElementById('phoneList').value.trim();
        const message = document.getElementById('smsMessage').value;
        
        if (!phoneList) {
            alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù‡ÙˆØ§ØªÙ');
            return;
        }
        
        const phones = phoneList.split('\\n').filter(phone => phone.trim());
        
        // Simulate SMS sending
        showDistributionResult('sms', `ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹ Ø¥Ù„Ù‰ ${phones.length} Ø±Ù‚Ù… Ù‡Ø§ØªÙ`);
    }
    
    // Send WhatsApp
    function sendWhatsApp() {
        const whatsappList = document.getElementById('whatsappList').value.trim();
        const message = document.getElementById('whatsappMessage').value;
        
        if (!whatsappList) {
            alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø£Ø±Ù‚Ø§Ù… ÙˆØ§ØªØ³Ø§Ø¨');
            return;
        }
        
        const numbers = whatsappList.split('\\n').filter(num => num.trim());
        
        // Simulate WhatsApp sending
        showDistributionResult('whatsapp', `ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹ Ø¥Ù„Ù‰ ${numbers.length} Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨`);
    }
    
    // Generate QR Code
    function generateQRCode() {
        if (!generatedSurveyUrl) {
            alert('ÙŠØ±Ø¬Ù‰ Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹ Ø£ÙˆÙ„Ø§Ù‹');
            return;
        }
        
        // Generate QR code (using a simple placeholder)
        document.getElementById('qrCodeContainer').innerHTML = `
            <div class="qr-code-generated">
                <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(generatedSurveyUrl)}" 
                     alt="QR Code" class="img-fluid">
            </div>
        `;
        
        document.getElementById('downloadQRBtn').style.display = 'block';
        showNotification('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø±Ù…Ø² QR Ø¨Ù†Ø¬Ø§Ø­!', 'success');
    }
    
    // Download QR
    function downloadQR() {
        const link = document.createElement('a');
        link.download = 'survey-qr-code.png';
        link.href = `https://api.qrserver.com/v1/create-qr-code/?size=400x400&data=${encodeURIComponent(generatedSurveyUrl)}`;
        link.click();
    }
    
    // Show distribution result
    function showDistributionResult(channel, message) {
        const resultsSection = document.getElementById('resultsSection');
        const results = document.getElementById('distributionResults');
        
        const channelIcons = {
            email: 'fas fa-envelope',
            sms: 'fas fa-sms',
            whatsapp: 'fab fa-whatsapp'
        };
        
        const channelColors = {
            email: 'primary',
            sms: 'success',
            whatsapp: 'success'
        };
        
        results.innerHTML += `
            <div class="alert alert-${channelColors[channel]} d-flex align-items-center mb-2">
                <i class="${channelIcons[channel]} me-3"></i>
                <span>${message}</span>
                <small class="text-muted ms-auto">${new Date().toLocaleTimeString('ar-SA')}</small>
            </div>
        `;
        
        resultsSection.style.display = 'block';
        resultsSection.scrollIntoView({ behavior: 'smooth' });
    }
    
    // Generate Footer Survey Widget
    function generateFooterWidget() {
        if (!generatedSurveyUrl) {
            alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ø³ØªØ·Ù„Ø§Ø¹ Ø£ÙˆÙ„Ø§Ù‹');
            return;
        }
        
        const backgroundColor = document.getElementById('footerBackgroundColor').value;
        const language = document.getElementById('footerLanguage').value;
        const callToAction = document.getElementById('footerCallToAction').value;
        const description = document.getElementById('footerDescription').value;
        const closeable = document.getElementById('footerCloseable').checked;
        
        // Generate government-style footer survey widget
        const footerCode = `<!-- Footer Survey Widget (pa.gov style) -->
<style>
.survey-footer-banner {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: ${backgroundColor};
    color: white;
    padding: 16px 20px;
    box-shadow: 0 -4px 12px rgba(0,0,0,0.15);
    z-index: 9999;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    transform: translateY(100%);
    transition: transform 0.3s ease;
}

.survey-footer-banner.show {
    transform: translateY(0);
}

.survey-footer-content {
    display: flex;
    align-items: center;
    justify-content: space-between;
    max-width: 1200px;
    margin: 0 auto;
    gap: 20px;
}

.survey-footer-text {
    flex: 1;
    display: flex;
    align-items: center;
    gap: 16px;
}

.survey-footer-icon {
    background: rgba(255,255,255,0.2);
    border-radius: 50%;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
}

.survey-footer-message {
    flex: 1;
}

.survey-footer-title {
    font-weight: 600;
    font-size: 16px;
    margin-bottom: 4px;
}

.survey-footer-desc {
    font-size: 14px;
    opacity: 0.9;
}

.survey-footer-actions {
    display: flex;
    gap: 12px;
    align-items: center;
}

.survey-footer-btn {
    background: white;
    color: ${backgroundColor};
    border: none;
    padding: 12px 24px;
    border-radius: 6px;
    font-weight: 600;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.2s;
    text-decoration: none;
    display: inline-block;
}

.survey-footer-btn:hover {
    background: rgba(255,255,255,0.9);
    transform: translateY(-1px);
}

.survey-footer-close {
    background: transparent;
    border: 1px solid rgba(255,255,255,0.5);
    color: white;
    padding: 8px 16px;
    border-radius: 4px;
    font-size: 12px;
    cursor: pointer;
    transition: all 0.2s;
}

.survey-footer-close:hover {
    background: rgba(255,255,255,0.1);
    border-color: rgba(255,255,255,0.8);
}

.survey-footer-banner.rtl {
    direction: rtl;
    text-align: right;
}

@media (max-width: 768px) {
    .survey-footer-content {
        flex-direction: column;
        text-align: center;
        gap: 12px;
    }
    
    .survey-footer-text {
        flex-direction: column;
        gap: 8px;
    }
    
    .survey-footer-actions {
        width: 100%;
        justify-content: center;
    }
    
    .survey-footer-btn {
        flex: 1;
        min-width: 120px;
    }
}
</style>

<div id="surveyFooterBanner" class="survey-footer-banner ${language === 'ar' ? 'rtl' : ''}">
    <div class="survey-footer-content">
        <div class="survey-footer-text">
            <div class="survey-footer-icon">
                ğŸ“‹
            </div>
            <div class="survey-footer-message">
                <div class="survey-footer-title">${callToAction}</div>
                <div class="survey-footer-desc">${description}</div>
            </div>
        </div>
        <div class="survey-footer-actions">
            <a href="${generatedSurveyUrl}" target="_blank" class="survey-footer-btn" onclick="trackSurveyClick()">
                ${language === 'ar' ? 'Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù†' : 'Take Survey'}
            </a>
            ${closeable ? `<button class="survey-footer-close" onclick="closeSurveyBanner()">
                ${language === 'ar' ? 'Ø¥ØºÙ„Ø§Ù‚' : 'Close'}
            </button>` : ''}
        </div>
    </div>
</div>

<script>
// Survey footer banner functionality
(function() {
    let bannerShown = false;
    let bannerClosed = localStorage.getItem('surveyBannerClosed');
    
    function showSurveyBanner() {
        if (bannerClosed || bannerShown) return;
        
        const banner = document.getElementById('surveyFooterBanner');
        if (banner) {
            // Show banner after 3 seconds on page
            setTimeout(() => {
                banner.classList.add('show');
                bannerShown = true;
            }, 3000);
        }
    }
    
    window.closeSurveyBanner = function() {
        const banner = document.getElementById('surveyFooterBanner');
        if (banner) {
            banner.classList.remove('show');
            localStorage.setItem('surveyBannerClosed', 'true');
            
            // Track close event
            if (typeof gtag !== 'undefined') {
                gtag('event', 'survey_banner_closed', {
                    'survey_id': '${generatedSurveyUrl.split('/').pop()}'
                });
            }
        }
    };
    
    window.trackSurveyClick = function() {
        // Track survey click
        if (typeof gtag !== 'undefined') {
            gtag('event', 'survey_banner_clicked', {
                'survey_id': '${generatedSurveyUrl.split('/').pop()}'
            });
        }
    };
    
    // Initialize banner when page loads
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', showSurveyBanner);
    } else {
        showSurveyBanner();
    }
    
    // Reset banner visibility on page navigation (for SPAs)
    window.addEventListener('beforeunload', function() {
        bannerShown = false;
    });
})();
</script>`;
        
        // Display the code
        document.getElementById('footerJavascriptCode').value = footerCode;
        document.getElementById('footerCodeSection').style.display = 'block';
        document.getElementById('footerPreviewSection').style.display = 'block';
        
        // Generate preview
        generateFooterPreview(backgroundColor, language, callToAction, description, closeable);
        
        showNotification('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø´Ø±ÙŠØ· Ø§Ù„ØªØ°ÙŠÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­! Ù…Ø«Ù„ Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ø­ÙƒÙˆÙ…ÙŠØ©', 'success');
    }
    
    // Generate footer widget preview
    function generateFooterPreview(backgroundColor, language, callToAction, description, closeable) {
        const isRTL = language === 'ar';
        const previewHtml = `
            <div style="position: absolute; bottom: 0; left: 0; right: 0; 
                        background: ${backgroundColor}; color: white; padding: 12px 16px; 
                        box-shadow: 0 -2px 8px rgba(0,0,0,0.2); 
                        direction: ${isRTL ? 'rtl' : 'ltr'};">
                <div style="display: flex; align-items: center; justify-content: space-between; gap: 16px;">
                    <div style="display: flex; align-items: center; gap: 12px; flex: 1;">
                        <div style="background: rgba(255,255,255,0.2); border-radius: 50%; 
                                   width: 32px; height: 32px; display: flex; align-items: center; 
                                   justify-content: center; font-size: 14px;">ğŸ“‹</div>
                        <div>
                            <div style="font-weight: 600; font-size: 14px; margin-bottom: 2px;">${callToAction}</div>
                            <div style="font-size: 12px; opacity: 0.9;">${description}</div>
                        </div>
                    </div>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <button style="background: white; color: ${backgroundColor}; border: none; 
                                      padding: 8px 16px; border-radius: 4px; font-weight: 600; 
                                      font-size: 12px; cursor: pointer;" 
                                onclick="alert('Ù…Ø¹Ø§ÙŠÙ†Ø©: Ø³ÙŠÙØªØ­ Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹ ÙÙŠ Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙŠØ¯Ø©')">
                            ${isRTL ? 'Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù†' : 'Take Survey'}
                        </button>
                        ${closeable ? `<button style="background: transparent; border: 1px solid rgba(255,255,255,0.5); 
                                               color: white; padding: 6px 12px; border-radius: 3px; 
                                               font-size: 11px; cursor: pointer;"
                                               onclick="this.parentElement.parentElement.parentElement.style.display='none'">
                            ${isRTL ? 'Ø¥ØºÙ„Ø§Ù‚' : 'Close'}
                        </button>` : ''}
                    </div>
                </div>
            </div>
        `;
        document.getElementById('previewFooterWidget').innerHTML = previewHtml;
    }
    
    // Copy footer JavaScript code
    function copyFooterCode() {
        const codeField = document.getElementById('footerJavascriptCode');
        codeField.select();
        document.execCommand('copy');
        showNotification('ØªÙ… Ù†Ø³Ø® ÙƒÙˆØ¯ Ø´Ø±ÙŠØ· Ø§Ù„ØªØ°ÙŠÙŠÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©', 'info');
    }
        
        // Color mapping
        const colorMap = {
            blue: '#007bff',
            green: '#28a745', 
            orange: '#fd7e14',
            purple: '#6f42c1'
        };
        
        // Generate the embeddable JavaScript code
        const jsCode = `<!-- Voice of Customer Survey Widget -->
<script>
(function() {
    // Widget Configuration
    var config = {
        surveyUrl: '${generatedSurveyUrl}',
        position: '${position}',
        color: '${colorMap[color]}',
        language: '${language}'
    };
    
    // Create widget
    function createWidget() {
        var widget = document.createElement('div');
        widget.id = 'voc-survey-widget';
        widget.style.position = 'fixed';
        widget.style.zIndex = '9999';
        widget.style.fontFamily = 'Arial, sans-serif';
        
        // Position the widget
        if (config.position === 'bottom-right') {
            widget.style.bottom = '20px';
            widget.style.right = '20px';
        } else if (config.position === 'bottom-left') {
            widget.style.bottom = '20px';
            widget.style.left = '20px';
        } else {
            widget.style.top = '50%';
            widget.style.left = '50%';
            widget.style.transform = 'translate(-50%, -50%)';
        }
        
        // Widget HTML
        var isArabic = config.language === 'ar' || (config.language === 'auto' && document.documentElement.lang === 'ar');
        var triggerText = isArabic ? 'Ø±Ø£ÙŠÙƒ' : 'Feedback';
        var direction = isArabic ? 'rtl' : 'ltr';
        
        widget.innerHTML = '<button id="voc-trigger" style="' +
            'background: ' + config.color + '; color: white; border: none; ' +
            'padding: 12px 20px; border-radius: 25px; cursor: pointer; ' +
            'box-shadow: 0 4px 12px rgba(0,0,0,0.2); font-size: 14px; ' +
            'direction: ' + direction + ';">' + triggerText + '</button>';
        
        document.body.appendChild(widget);
        
        // Click handler
        document.getElementById('voc-trigger').onclick = function() {
            window.open(config.surveyUrl, '_blank', 'width=600,height=700');
        };
    }
    
    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', createWidget);
    } else {
        createWidget();
    }
})();
</script>`;
        
        // Display the code
        document.getElementById('javascriptCode').value = jsCode;
        document.getElementById('jsCodeSection').style.display = 'block';
        document.getElementById('previewSection').style.display = 'block';
        
        // Generate preview
        generatePreview(position, colorMap[color], language);
        
        showNotification('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙˆØ¯ Ø§Ù„ØªØ¶Ù…ÙŠÙ† Ø¨Ù†Ø¬Ø§Ø­!', 'success');
    }
    
    // Generate widget preview
    function generatePreview(position, color, language) {
        const isArabic = language === 'ar';
        const triggerText = isArabic ? 'Ø±Ø£ÙŠÙƒ' : 'Feedback';
        const direction = isArabic ? 'rtl' : 'ltr';
        
        let previewStyle = 'position: absolute; ';
        if (position === 'bottom-right') {
            previewStyle += 'bottom: 10px; right: 10px;';
        } else if (position === 'bottom-left') {
            previewStyle += 'bottom: 10px; left: 10px;';
        } else {
            previewStyle += 'top: 50%; left: 50%; transform: translate(-50%, -50%);';
        }
        
        document.getElementById('previewWidget').innerHTML = `
            <button style="${previewStyle} background: ${color}; color: white; border: none; 
                          padding: 12px 20px; border-radius: 25px; cursor: pointer; 
                          box-shadow: 0 4px 12px rgba(0,0,0,0.2); font-size: 14px; 
                          direction: ${direction};" 
                    onclick="alert('${isArabic ? 'Ù…Ø¹Ø§ÙŠÙ†Ø©: Ø³ÙŠÙØªØ­ Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹ ÙÙŠ Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙŠØ¯Ø©' : 'Preview: Survey would open in new window'}')">
                ${triggerText}
            </button>
        `;
    }
    
    // Copy JavaScript code to clipboard
    function copyJSCode() {
        const codeTextarea = document.getElementById('javascriptCode');
        codeTextarea.select();
        document.execCommand('copy');
        showNotification('ØªÙ… Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
    }
    
    // Generate Sidebar Feedback Widget
    function generateSidebarWidget() {
        if (!generatedSurveyUrl) {
            alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ø³ØªØ·Ù„Ø§Ø¹ Ø£ÙˆÙ„Ø§Ù‹');
            return;
        }
        
        const position = document.getElementById('sidebarPosition').value;
        const color = document.getElementById('sidebarColor').value;
        
        // Generate the sidebar feedback widget JavaScript code (self-contained)
        const sidebarCode = `<!-- Sidebar Feedback Widget -->
<style>
:root {
    --sidebar-primary: ${color};
    --sidebar-hover: ${adjustColor(color, -20)};
    --sidebar-text: #ffffff;
}

.sidebar-feedback-widget {
    position: fixed;
    ${position.includes('right') ? 'right: 0;' : 'left: 0;'}
    ${position.includes('center') ? 'top: 50%; transform: translateY(-50%);' : 'bottom: 100px;'}
    z-index: 9999;
    font-family: 'Cairo', sans-serif;
}

.sidebar-feedback-trigger {
    background: var(--sidebar-primary);
    color: var(--sidebar-text);
    border: none;
    border-radius: ${position.includes('right') ? '8px 0 0 8px' : '0 8px 8px 0'};
    padding: 16px 12px;
    cursor: pointer;
    box-shadow: ${position.includes('right') ? '-2px 0 10px rgba(0,0,0,0.3)' : '2px 0 10px rgba(0,0,0,0.3)'};
    transition: all 0.3s ease;
    writing-mode: vertical-${position.includes('right') ? 'lr' : 'rl'};
    text-orientation: mixed;
    min-height: 120px;
    font-weight: 600;
    font-size: 12px;
}

.sidebar-feedback-trigger:hover {
    background: var(--sidebar-hover);
    transform: translateX(${position.includes('right') ? '-3px' : '3px'});
}

.sidebar-feedback-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 10000;
}

.sidebar-feedback-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    padding: 24px;
    border-radius: 12px;
    width: 90%;
    max-width: 500px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
}

.sidebar-feedback-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.sidebar-feedback-close {
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: #999;
}

.sidebar-rating {
    text-align: center;
    margin-bottom: 16px;
}

.sidebar-stars {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin: 12px 0;
}

.sidebar-star {
    font-size: 28px;
    cursor: pointer;
    color: #ddd;
    transition: color 0.2s;
}

.sidebar-star.active, .sidebar-star:hover {
    color: #ffc107;
}

.sidebar-textarea {
    width: 100%;
    padding: 12px;
    border: 2px solid #e9ecef;
    border-radius: 8px;
    resize: none;
    font-family: inherit;
    margin-bottom: 16px;
}

.sidebar-submit {
    background: var(--sidebar-primary);
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 8px;
    cursor: pointer;
    width: 100%;
    font-weight: 600;
}

.sidebar-submit:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}
</style>

<div class="sidebar-feedback-widget">
    <button class="sidebar-feedback-trigger" onclick="openSidebarFeedback()">
        Ø±Ø£ÙŠÙƒ
    </button>
</div>

<div id="sidebarFeedbackModal" class="sidebar-feedback-modal" onclick="closeSidebarFeedback(event)">
    <div class="sidebar-feedback-content" onclick="event.stopPropagation()">
        <div class="sidebar-feedback-header">
            <h3>Ø´Ø§Ø±ÙƒÙ†Ø§ Ø±Ø£ÙŠÙƒ ÙÙŠ Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹</h3>
            <button class="sidebar-feedback-close" onclick="closeSidebarFeedback()">&times;</button>
        </div>
        
        <div class="sidebar-rating">
            <label>ÙƒÙŠÙ ØªÙ‚ÙŠÙ… Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹ØŸ</label>
            <div class="sidebar-stars" id="sidebarStars">
                <span class="sidebar-star" data-rating="1">â­</span>
                <span class="sidebar-star" data-rating="2">â­</span>
                <span class="sidebar-star" data-rating="3">â­</span>
                <span class="sidebar-star" data-rating="4">â­</span>
                <span class="sidebar-star" data-rating="5">â­</span>
            </div>
        </div>
        
        <textarea class="sidebar-textarea" id="sidebarComment" placeholder="Ø£Ø®Ø¨Ø±Ù†Ø§ Ø§Ù„Ù…Ø²ÙŠØ¯ Ø¹Ù† ØªØ¬Ø±Ø¨ØªÙƒ Ù…Ø¹ Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹..." rows="4"></textarea>
        
        <button class="sidebar-submit" id="sidebarSubmitBtn" onclick="submitSidebarFeedback()">
            Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
        </button>
    </div>
</div>

<script>
let sidebarRating = 0;

function openSidebarFeedback() {
    document.getElementById('sidebarFeedbackModal').style.display = 'block';
}

function closeSidebarFeedback(event) {
    if (!event || event.target === event.currentTarget) {
        document.getElementById('sidebarFeedbackModal').style.display = 'none';
        resetSidebarForm();
    }
}

function resetSidebarForm() {
    sidebarRating = 0;
    document.getElementById('sidebarComment').value = '';
    document.querySelectorAll('.sidebar-star').forEach(star => star.classList.remove('active'));
}

// Star rating functionality
document.addEventListener('DOMContentLoaded', function() {
    const stars = document.querySelectorAll('.sidebar-star');
    stars.forEach(star => {
        star.addEventListener('click', function() {
            sidebarRating = parseInt(this.dataset.rating);
            stars.forEach((s, index) => {
                s.classList.toggle('active', index < sidebarRating);
            });
        });
    });
});

function submitSidebarFeedback() {
    const comment = document.getElementById('sidebarComment').value.trim();
    
    if (sidebarRating === 0) {
        alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØªÙ‚ÙŠÙŠÙ…');
        return;
    }
    
    const submitBtn = document.getElementById('sidebarSubmitBtn');
    submitBtn.disabled = true;
    submitBtn.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...';
    
    // Redirect to survey with feedback parameters
    const surveyUrl = '${generatedSurveyUrl}' + 
        '?feedback_rating=' + sidebarRating + 
        '&feedback_comment=' + encodeURIComponent(comment) +
        '&source=sidebar_widget';
    
    // Open survey in new window
    window.open(surveyUrl, '_blank', 'width=800,height=700');
    
    // Close modal and show success
    setTimeout(() => {
        closeSidebarFeedback();
        alert('Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ! ØªÙ… ÙØªØ­ Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹ ÙÙŠ Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙŠØ¯Ø©');
    }, 1000);
}
</script>`;
        
        // Display the code
        document.getElementById('sidebarJavascriptCode').value = sidebarCode;
        document.getElementById('sidebarCodeSection').style.display = 'block';
        document.getElementById('sidebarPreviewSection').style.display = 'block';
        
        // Generate preview
        generateSidebarPreview(position, color);
        
        showNotification('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø£Ø¯Ø§Ø© Ø§Ù„ØªØºØ°ÙŠØ© Ø§Ù„Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© Ø¨Ù†Ø¬Ø§Ø­!', 'success');
    }
    
    // Generate sidebar widget preview
    function generateSidebarPreview(position, color) {
        const previewHtml = `
            <div style="position: absolute; ${position.includes('right') ? 'right: 10px;' : 'left: 10px;'} 
                        ${position.includes('center') ? 'top: 50%; transform: translateY(-50%);' : 'bottom: 20px;'}">
                <button style="background: ${color}; color: white; border: none; 
                              border-radius: ${position.includes('right') ? '8px 0 0 8px' : '0 8px 8px 0'}; 
                              padding: 16px 12px; writing-mode: vertical-${position.includes('right') ? 'lr' : 'rl'}; 
                              text-orientation: mixed; min-height: 100px; font-weight: 600; 
                              font-size: 11px; cursor: pointer;" 
                        onclick="alert('Ù…Ø¹Ø§ÙŠÙ†Ø©: Ø³ØªÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙ‚ÙŠÙŠÙ…')">
                    Ø±Ø£ÙŠÙƒ
                </button>
            </div>
        `;
        document.getElementById('previewSidebarWidget').innerHTML = previewHtml;
    }
    
    // Copy sidebar JavaScript code
    function copySidebarCode() {
        const codeField = document.getElementById('sidebarJavascriptCode');
        codeField.select();
        document.execCommand('copy');
        showNotification('ØªÙ… Ù†Ø³Ø® ÙƒÙˆØ¯ Ø§Ù„Ø£Ø¯Ø§Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©', 'info');
    }
    
    // Utility function to adjust color brightness
    function adjustColor(color, amount) {
        const usePound = color[0] === '#';
        const col = usePound ? color.slice(1) : color;
        const num = parseInt(col, 16);
        let r = (num >> 16) + amount;
        let g = (num >> 8 & 0x00FF) + amount;
        let b = (num & 0x0000FF) + amount;
        r = r > 255 ? 255 : r < 0 ? 0 : r;
        g = g > 255 ? 255 : g < 0 ? 0 : g;
        b = b > 255 ? 255 : b < 0 ? 0 : b;
        return (usePound ? '#' : '') + (r << 16 | g << 8 | b).toString(16).padStart(6, '0');
    }
    
    // Show notification
    function showNotification(message, type) {
        // Simple notification system
        const notification = document.createElement('div');
        notification.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
        notification.style.top = '20px';
        notification.style.left = '20px';
        notification.style.zIndex = '9999';
        notification.innerHTML = `
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.remove();
        }, 3000);
    }
    
    // Update embeddable widget with real survey URL
    function updateEmbeddableWidget() {
        if (!generatedSurveyUrl) return;
        
        // Update the widget code generator with the actual survey URL
        const widgetScript = document.getElementById('widgetScript');
        if (widgetScript) {
            const currentCode = widgetScript.value;
            const updatedCode = currentCode.replace(/surveyUrl:\s*['"][^'"]*['"]/, `surveyUrl: '${generatedSurveyUrl}'`);
            widgetScript.value = updatedCode;
        }
        
        console.log('Updated embeddable widget with survey URL:', generatedSurveyUrl);
    }
    
    // Generate QR Code
    function generateQRCode(url) {
        const qrContainer = document.getElementById('qrcode');
        if (qrContainer && url) {
            // Clear existing QR code
            qrContainer.innerHTML = '';
            
            // Generate new QR code
            try {
                new QRCode(qrContainer, {
                    text: url,
                    width: 200,
                    height: 200,
                    colorDark: "#000000",
                    colorLight: "#ffffff",
                    correctLevel: QRCode.CorrectLevel.M
                });
                console.log('QR code generated for:', url);
            } catch (error) {
                console.log('QR code library not available, showing text fallback');
                qrContainer.innerHTML = `<div class="text-center p-3 border rounded">
                    <i class="fas fa-qrcode fa-3x text-muted mb-2"></i>
                    <p class="small text-muted">Ø±Ù…Ø² QR ØºÙŠØ± Ù…ØªØ§Ø­<br/>Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</p>
                </div>`;
            }
        }
    }
    </script>
</body>
</html>