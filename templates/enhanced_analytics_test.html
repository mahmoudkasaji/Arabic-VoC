<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    {% include 'components/head.html' %}
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø­Ø³Ù†Ø© - Ù…Ù†ØµØ© ØµÙˆØª Ø§Ù„Ø¹Ù…ÙŠÙ„</title>
    <style>
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .test-section {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .analysis-result {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
            border-left: 4px solid #007bff;
        }
        
        .emotion-badge {
            display: inline-block;
            background: #e3f2fd;
            color: #1976d2;
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 0.875rem;
            margin: 2px;
        }
        
        .topic-badge {
            display: inline-block;
            background: #e8f5e8;
            color: #2e7d32;
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 0.875rem;
            margin: 2px;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #6c757d;
        }
        
        .btn-test {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            margin: 8px;
        }
        
        .btn-test:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .metric-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            margin: 12px;
        }
        
        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
        }
        
        .metric-label {
            color: #666;
            font-size: 0.875rem;
        }
    </style>
</head>
<body>
    {% include 'components/unified_navigation.html' %}
    
    <div class="test-container">
        <div class="test-section">
            <h1>ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø­Ø³Ù†Ø© - Ø§Ù„Ù…Ø±Ø­Ù„Ø© 3Ø£</h1>
            <p>Ø§Ø®ØªØ¨Ø§Ø± ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø´Ø§Ø¹Ø± ÙˆØ§Ù„Ù…ÙˆØ§Ø¶ÙŠØ¹ Ø§Ù„Ù…Ø­Ø³Ù† Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù…Ù† Ø§Ù„Ø§Ø³ØªØ·Ù„Ø§Ø¹Ø§Øª</p>
            
            <div style="display: flex; gap: 16px; margin: 20px 0;">
                <button class="btn-test" onclick="testRealResponses()">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©</button>
                <button class="btn-test" onclick="testTextAnalysis()">Ø§Ø®ØªØ¨Ø§Ø± ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†ØµÙˆØµ</button>
                <button class="btn-test" onclick="getTopicInsights()">Ø±Ø¤Ù‰ Ø§Ù„Ù…ÙˆØ§Ø¶ÙŠØ¹</button>
            </div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ“Š Ù†ØªØ§Ø¦Ø¬ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ø­Ø³Ù†</h2>
            <div id="results-container">
                <div class="loading">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø£Ø­Ø¯ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø£Ø¹Ù„Ø§Ù‡ Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ“ˆ Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø©</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                <div class="metric-card">
                    <div class="metric-value" id="total-responses">2</div>
                    <div class="metric-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="emotions-detected">6</div>
                    <div class="metric-label">Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ø´Ø§Ø¹Ø± Ø§Ù„Ù…ÙƒØªØ´ÙØ©</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="topics-identified">3</div>
                    <div class="metric-label">Ø§Ù„Ù…ÙˆØ§Ø¶ÙŠØ¹ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="avg-processing">8.2s</div>
                    <div class="metric-label">Ù…ØªÙˆØ³Ø· ÙˆÙ‚Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        async function testRealResponses() {
            const container = document.getElementById('results-container');
            container.innerHTML = '<div class="loading">ğŸ”„ Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©...</div>';
            
            try {
                const response = await fetch('/api/enhanced-analytics/historical-analysis?limit=5');
                const data = await response.json();
                
                if (data.success) {
                    displayHistoricalResults(data.data);
                } else {
                    container.innerHTML = `<div class="analysis-result" style="border-left-color: #dc3545; background: #f8d7da;">âŒ Ø®Ø·Ø£: ${data.error}</div>`;
                }
            } catch (error) {
                console.error('Error:', error);
                container.innerHTML = '<div class="analysis-result" style="border-left-color: #dc3545; background: #f8d7da;">âŒ ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø®Ø¯Ù…Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„</div>';
            }
        }
        
        async function testTextAnalysis() {
            const container = document.getElementById('results-container');
            container.innerHTML = '<div class="loading">ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†ØµÙˆØµ...</div>';
            
            const testTexts = [
                "Ø´ÙƒØ±Ø§Ù‹ Ø¬Ø²ÙŠÙ„Ø§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ù…Ù…ØªØ§Ø²Ø©",
                "Ø£Ù†Ø§ Ù…Ù†Ø²Ø¹Ø¬ Ù…Ù† Ø¨Ø·Ø¡ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©", 
                "Great service! Very happy with the product quality"
            ];
            
            let results = '<h3>Ù†ØªØ§Ø¦Ø¬ Ø§Ø®ØªØ¨Ø§Ø± ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù†ØµÙˆØµ:</h3>';
            
            for (let i = 0; i < testTexts.length; i++) {
                try {
                    const response = await fetch('/api/enhanced-analytics/analyze-text', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ text: testTexts[i] })
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        results += formatAnalysisResult(data.data, testTexts[i]);
                    } else {
                        results += `<div class="analysis-result">âŒ ÙØ´Ù„ ØªØ­Ù„ÙŠÙ„: ${testTexts[i]}</div>`;
                    }
                } catch (error) {
                    results += `<div class="analysis-result">âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù„ÙŠÙ„: ${testTexts[i]}</div>`;
                }
            }
            
            container.innerHTML = results;
        }
        
        async function getTopicInsights() {
            const container = document.getElementById('results-container');
            container.innerHTML = '<div class="loading">ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø±Ø¤Ù‰ Ø§Ù„Ù…ÙˆØ§Ø¶ÙŠØ¹...</div>';
            
            try {
                const response = await fetch('/api/enhanced-analytics/topic-insights?time_range=all');
                const data = await response.json();
                
                if (data.success) {
                    displayTopicInsights(data.data);
                } else {
                    container.innerHTML = `<div class="analysis-result" style="border-left-color: #dc3545;">âŒ Ø®Ø·Ø£: ${data.error}</div>`;
                }
            } catch (error) {
                container.innerHTML = '<div class="analysis-result" style="border-left-color: #dc3545;">âŒ ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø±Ø¤Ù‰ Ø§Ù„Ù…ÙˆØ§Ø¶ÙŠØ¹</div>';
            }
        }
        
        function displayHistoricalResults(data) {
            const container = document.getElementById('results-container');
            let html = `<h3>ğŸ“‹ ØªØ­Ù„ÙŠÙ„ ${data.total_responses} Ø¥Ø¬Ø§Ø¨Ø© Ø­Ù‚ÙŠÙ‚ÙŠØ©:</h3>`;
            
            if (data.analyzed_responses && data.analyzed_responses.length > 0) {
                data.analyzed_responses.forEach((response, index) => {
                    const emotion = response.primary_emotion || {};
                    const sentiment = response.sentiment || {};
                    const topics = response.topics || [];
                    
                    html += `
                        <div class="analysis-result">
                            <h4>Ø¥Ø¬Ø§Ø¨Ø© ${index + 1} (ID: ${response.response_id})</h4>
                            <p><strong>Ø§Ù„Ù†Øµ:</strong> ${response.original_text || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</p>
                            <p><strong>Ø§Ù„Ù…Ø´Ø§Ø¹Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©:</strong> 
                                <span class="emotion-badge">${emotion.emotion || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'} (${((emotion.confidence || 0) * 100).toFixed(0)}%)</span>
                            </p>
                            <p><strong>Ø§Ù„Ù…ÙˆØ§Ø¶ÙŠØ¹:</strong> 
                                ${topics.map(topic => `<span class="topic-badge">${topic.category} (${(topic.relevance * 100).toFixed(0)}%)</span>`).join(' ')}
                            </p>
                            <p><strong>Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¹Ø§Ø·ÙÙŠ:</strong> ${sentiment.label || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'} (${(sentiment.score || 0).toFixed(2)})</p>
                            <p><strong>ÙˆÙ‚Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©:</strong> ${response.processing_time || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}s</p>
                        </div>
                    `;
                });
                
                // Display summary
                const summary = data.summary || {};
                html += `
                    <div class="analysis-result" style="border-left-color: #28a745; background: #d4edda;">
                        <h4>ğŸ“Š Ù…Ù„Ø®Øµ Ø§Ù„ØªØ­Ù„ÙŠÙ„:</h4>
                        <p><strong>ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø´Ø§Ø¹Ø±:</strong> ${JSON.stringify(summary.emotion_distribution || {})}</p>
                        <p><strong>ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…ÙˆØ§Ø¶ÙŠØ¹:</strong> ${JSON.stringify(summary.topic_distribution || {})}</p>
                        <p><strong>Ù…ØªÙˆØ³Ø· Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¹Ø§Ø·ÙÙŠ:</strong> ${(summary.sentiment_comparison?.average_sentiment || 0).toFixed(2)}</p>
                    </div>
                `;
            } else {
                html += '<div class="analysis-result">âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬ ØªØ­Ù„ÙŠÙ„</div>';
            }
            
            container.innerHTML = html;
        }
        
        function formatAnalysisResult(analysis, originalText) {
            const emotion = analysis.primary_emotion || {};
            const sentiment = analysis.sentiment || {};
            const topics = analysis.topics || [];
            const insights = analysis.insights || {};
            
            return `
                <div class="analysis-result">
                    <h4>Ø§Ù„Ù†Øµ: "${originalText}"</h4>
                    <p><strong>Ø§Ù„Ù…Ø´Ø§Ø¹Ø±:</strong> <span class="emotion-badge">${emotion.emotion} (${((emotion.confidence || 0) * 100).toFixed(0)}%)</span></p>
                    <p><strong>Ø§Ù„Ù…ÙˆØ§Ø¶ÙŠØ¹:</strong> ${topics.map(t => `<span class="topic-badge">${t.category}</span>`).join(' ')}</p>
                    <p><strong>Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¹Ø§Ø·ÙÙŠ:</strong> ${sentiment.label} (${(sentiment.score || 0).toFixed(2)})</p>
                    <p><strong>Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ©:</strong> ${(analysis.keywords || []).join(', ')}</p>
                    <p><strong>Ø§Ù„Ù„ØºØ©:</strong> ${analysis.language_detected}</p>
                    <p><strong>ÙˆÙ‚Øª Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©:</strong> ${analysis.processing_time}s</p>
                    ${insights.key_points && insights.key_points.length > 0 ? 
                        `<p><strong>Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©:</strong> ${insights.key_points.join(', ')}</p>` : ''}
                </div>
            `;
        }
        
        function displayTopicInsights(data) {
            const container = document.getElementById('results-container');
            const topicInsights = data.topic_insights || {};
            
            let html = `<h3>ğŸ¯ Ø±Ø¤Ù‰ Ø§Ù„Ù…ÙˆØ§Ø¶ÙŠØ¹ (${data.total_categories} ÙØ¦Ø§Øª Ù…Ù† ${data.total_responses_analyzed} Ø¥Ø¬Ø§Ø¨Ø©):</h3>`;
            
            if (Object.keys(topicInsights).length > 0) {
                Object.entries(topicInsights).forEach(([category, data]) => {
                    html += `
                        <div class="analysis-result">
                            <h4>${category}</h4>
                            <p><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ø¥Ø´Ø§Ø±Ø§Øª:</strong> ${data.total_mentions}</p>
                            <p><strong>Ù…ØªÙˆØ³Ø· Ø§Ù„ØµÙ„Ø©:</strong> ${data.avg_relevance}</p>
                            <p><strong>Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ©:</strong> ${data.keywords.join(', ')}</p>
                            <p><strong>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª:</strong> ${data.responses.join(', ')}</p>
                        </div>
                    `;
                });
            } else {
                html += '<div class="analysis-result">âš ï¸ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø±Ø¤Ù‰ Ù„Ù„Ù…ÙˆØ§Ø¶ÙŠØ¹</div>';
            }
            
            container.innerHTML = html;
        }
        
        // Auto-load real responses on page load
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(testRealResponses, 1000);
        });
    </script>

    {% include 'components/scripts.html' %}
</body>
</html>